<script>
  function showLoadingMessage(text) {
    document.getElementById("render-status").innerText = text;
  }

  function displayVideo(url) {
    const container = document.getElementById("video-container");
    container.innerHTML = `<video controls autoplay width='100%'>
      <source src='${url}' type='video/mp4'>Your browser does not support video.
    </video>`;
  }

  function showError(message) {
    const container = document.getElementById("render-status");
    container.innerText = message;
    container.style.color = 'red';
  }

  async function renderScene() {
    showLoadingMessage("ðŸ§  JARVIS is rendering the cinematic experience...");

    try {
      const response = await fetch("https://nova-backend.vercel.app/api/render", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          scene: "A lonely astronaut stares at Earth from orbit...",
          emotion: "melancholy",
          voice: "whispered",
          music: "ambient_echoes",
          lang: "en"
        }),
      });

      const result = await response.json();

      if (result.success && result.videoUrl) {
        displayVideo(result.videoUrl);
      } else {
        showError("JARVIS failed to render. Please try again later.");
      }
    } catch (error) {
      console.error("Rendering failed:", error);
      showError("JARVIS encountered a glitch during rendering.");
    }
  }

  renderScene();
</script>
